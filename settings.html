<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Настройки расписания</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #fafafa;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .dates-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .date-item {
            margin: 5px;
        }
        .date-item label {
            display: block;
            font-size: 0.8em;
            margin-bottom: 2px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            overflow-x: auto;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: center;
            font-size: 0.8em;
        }
        th {
            background-color: #f0f0f0;
        }
        .name-input {
            width: 100%;
            box-sizing: border-box;
        }
        .controls {
            margin-top: 15px;
            text-align: center;
        }
        button {
            padding: 6px 12px;
            margin: 3px;
        }
        .footer-link {
            text-align: center;
            margin-top: 20px;
        }
        @media (max-width: 600px) {
            table th, table td {
                font-size: 0.7em;
                padding: 3px;
            }
        }
    </style>
</head>
<body>
    <h1>Настройки расписания</h1>
    <div class="dates-container" id="datesContainer">
        <!-- date inputs inserted here -->
    </div>
    <table id="employeesTable">
        <thead>
            <tr id="tableHeader">
                <th rowspan="2">Имя</th>
                <!-- dynamic date headers inserted here: two columns per day -->
            </tr>
            <tr id="shiftHeader">
                <!-- dynamic shift headers inserted here: «Утро», «Вечер» per day -->
            </tr>
        </thead>
        <tbody id="employeesBody">
            <!-- employee rows -->
        </tbody>
    </table>
    <div class="controls">
        <button onclick="addEmployeeRow()">Добавить сотрудника</button>
        <button onclick="saveData()">Сохранить</button>
    </div>
    <div class="footer-link">
        <a href="index.html">Назад к расписанию</a>
    </div>

    <script>
    // Schedule data structure stored in localStorage
    function loadData() {
        const data = JSON.parse(localStorage.getItem('scheduleData') || '{}');
        // ensure structure
        if (!data.dates || data.dates.length !== 7) {
            // initialize with next 7 days
            const dates = [];
            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(today.getDate() + i);
                dates.push(d.toISOString().substring(0,10));
            }
            data.dates = dates;
        }
        if (!data.employees) {
            data.employees = [];
        }
        return data;
    }
    let schedule = loadData();

    function saveData() {
        localStorage.setItem('scheduleData', JSON.stringify(schedule));
        alert('Данные сохранены');
    }
    function updateDate(idx, value) {
        schedule.dates[idx] = value;
        refreshHeaders();
    }
    function addEmployeeRow(emp) {
        if (!emp) {
            emp = { name: '', shifts: {} };
            schedule.employees.push(emp);
        }
        const rowIndex = schedule.employees.indexOf(emp);
        const tbody = document.getElementById('employeesBody');
        const tr = document.createElement('tr');
        // name cell
        const nameTd = document.createElement('td');
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.className = 'name-input';
        nameInput.value = emp.name;
        nameInput.onchange = () => {
            emp.name = nameInput.value;
        };
        nameTd.appendChild(nameInput);
        tr.appendChild(nameTd);
        // shift checkboxes
        for (let d = 0; d < 7; d++) {
            // morning
            const mTd = document.createElement('td');
            const mCheck = document.createElement('input');
            mCheck.type = 'checkbox';
            mCheck.checked = !!emp.shifts[d + '-morning'];
            mCheck.onchange = () => {
                if (mCheck.checked) {
                    emp.shifts[d + '-morning'] = true;
                } else {
                    delete emp.shifts[d + '-morning'];
                }
            };
            mTd.appendChild(mCheck);
            tr.appendChild(mTd);
            // evening
            const eTd = document.createElement('td');
            const eCheck = document.createElement('input');
            eCheck.type = 'checkbox';
            eCheck.checked = !!emp.shifts[d + '-evening'];
            eCheck.onchange = () => {
                if (eCheck.checked) {
                    emp.shifts[d + '-evening'] = true;
                } else {
                    delete emp.shifts[d + '-evening'];
                }
            };
            eTd.appendChild(eCheck);
            tr.appendChild(eTd);
        }
        tbody.appendChild(tr);
    }
    function refreshHeaders() {
        const tableHeader = document.getElementById('tableHeader');
        const shiftHeader = document.getElementById('shiftHeader');
        // clear existing th except first
        while (tableHeader.children.length > 1) tableHeader.removeChild(tableHeader.lastChild);
        while (shiftHeader.firstChild) shiftHeader.removeChild(shiftHeader.firstChild);
        // update dates inputs and headers
        schedule.dates.forEach((dateStr, idx) => {
            // date header spanning two columns
            const thDate = document.createElement('th');
            thDate.colSpan = 2;
            thDate.textContent = formatDateLabel(dateStr);
            tableHeader.appendChild(thDate);
            // shift titles
            const thM = document.createElement('th');
            thM.textContent = 'Утро';
            const thE = document.createElement('th');
            thE.textContent = 'Вечер';
            shiftHeader.appendChild(thM);
            shiftHeader.appendChild(thE);
        });
    }
    function formatDateLabel(dateStr) {
        if (!dateStr) return '';
        const d = new Date(dateStr);
        if (isNaN(d)) return dateStr;
        const options = { weekday: 'short' };
        const dow = d.toLocaleDateString('ru-RU', options);
        const day = ('0' + d.getDate()).slice(-2);
        const month = ('0' + (d.getMonth()+1)).slice(-2);
        return dow.charAt(0).toUpperCase() + dow.slice(1) + ' ' + day + '-' + month;
    }
    function populateDates() {
        const container = document.getElementById('datesContainer');
        container.innerHTML = '';
        schedule.dates.forEach((val, idx) => {
            const div = document.createElement('div');
            div.className = 'date-item';
            const label = document.createElement('label');
            label.textContent = 'Дата ' + (idx + 1);
            const input = document.createElement('input');
            input.type = 'date';
            input.value = val;
            input.onchange = () => updateDate(idx, input.value);
            div.appendChild(label);
            div.appendChild(input);
            container.appendChild(div);
        });
    }
    function populateEmployees() {
        const tbody = document.getElementById('employeesBody');
        tbody.innerHTML = '';
        schedule.employees.forEach(emp => {
            addEmployeeRow(emp);
        });
    }
    document.addEventListener('DOMContentLoaded', () => {
        populateDates();
        refreshHeaders();
        populateEmployees();
    });
    </script>
</body>
</html>