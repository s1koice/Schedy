<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="utf-8" />
  <title>סידור עבודה – ראשי</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --bg:#f7f7f7; --card:#fff; --text:#222; --muted:#666; --line:#e6e6e6; --accent:#1a73e8; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Arial,Helvetica,sans-serif}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;padding:16px 20px;flex-wrap:wrap}
    header h1{font-size:20px;margin:0}
    header nav a{color:var(--accent);text-decoration:none;margin-inline-start:14px}
    .bar{height:1px;background:var(--line)}
    .controls{display:flex;gap:14px;align-items:center;padding:10px 20px;color:var(--muted);font-size:13px;flex-wrap:wrap}
    .chip{display:inline-flex;gap:6px;align-items:center}
    .actions{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
    .btn{border:0;border-radius:10px;padding:7px 12px;font-size:13px;cursor:pointer}
    .btn.ghost{background:#eef4ff;color:#1a73e8}
    .grid{display:flex;gap:16px;padding:20px;overflow-x:auto;-webkit-overflow-scrolling:touch}
    .day-card{flex:0 0 320px;background:var(--card);border-radius:12px;padding:14px;box-shadow:0 4px 16px rgba(0,0,0,.06);border:1px solid var(--line)}
    .day-head{display:flex;justify-content:space-between;align-items:baseline;margin-bottom:8px}
    .day-head .dow{font-weight:700}
    .day-head .date{color:var(--muted);font-size:14px}
    .section{margin-top:10px}
    .section h3{font-size:14px;margin:0 0 8px 0;color:#333;display:flex;align-items:center;justify-content:space-between}
    /* список: «№, имя — время» */
    ol{margin:0;padding:0;list-style:none}
    li{padding:2px 0;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .li-text{flex:1}
    .li-num{opacity:.7; min-width:2.4em}
    .empty{color:var(--muted);font-style:italic}
    .btn.icon{background:#ffecee;color:#c62828;border-radius:8px;padding:2px 8px;line-height:1}
    .addRow{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    select,input[type="text"]{border:1px solid var(--line);border-radius:8px;padding:7px 10px;font-size:13px}
    footer{padding:4px 20px 16px;color:var(--muted);font-size:12px}

    /* панель выбора дней */
    .day-picker{display:flex;align-items:center;gap:8px;padding:8px 20px;flex-wrap:wrap}
    .day-picker .badge{background:#fff;border:1px solid var(--line);border-radius:10px;padding:6px 10px;display:flex;align-items:center;gap:8px}
    .day-picker .label{font-size:13px;color:#333}
  </style>

  <!-- Библиотека для DOCX -->
  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <!-- HTML → PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
  <header>
    <h1 id="t_title">סידור עבודה</h1>
    <nav>
      <a id="t_settings" href="settings.html">הגדרות</a>
      <a href="#" id="langToggle">Русский</a>
    </nav>
  </header>
  <div class="bar"></div>

  <div class="controls">
    <label class="chip">
      <input type="checkbox" id="showBO" />
      <span id="t_showBO">Показывать Backoffice</span>
    </label>
    <label class="chip">
      <input type="checkbox" id="editMode" />
      <span id="t_edit">Редактировать</span>
    </label>

    <div class="actions">
      <button class="btn ghost" id="btnTxt">TXT</button>
      <button class="btn ghost" id="btnDocx">DOCX</button>
      <button class="btn ghost" id="btnPdf">PDF</button>
    </div>
  </div>

  <!-- выбор дней для экспорта -->
  <div class="day-picker" id="dayPicker"></div>

  <main class="grid" id="daysGrid"></main>
  <footer id="t_tip">העדכונים נעשים בדף הגדרות ונשמרים בדפדפן (localStorage).</footer>

  <script>
    // ===== i18n =====
    const I18N = {
      he: {
        _dir:'rtl',
        title:'סידור עבודה',
        settings:'הגדרות',
        tip:'העדכונים נעשים בדף הגדרות ונשמרים בדפדפן (localStorage).',
        morning:'בוקר', evening:'ערב',
        weekdaysFull:['ראשון','שני','שלישי','רביעי','חמישי','שישי','שבת'],
        langToggle:'עברית',
        showBO:'להציג בק־אופיס',
        edit:'עריכה',
        add:'הוספה', remove:'הסרה',
        timePH:'שעה',
        fmt:(iso)=> new Date(iso).toLocaleDateString('he-IL'),
        btnTxt:'TXT', btnDocx:'DOCX', btnPdf:'PDF',
        labelMorning:(i)=>`בוקר`,
        labelEvening:(i)=>`ערב`,
        chooseDays:'בחר ימים לייצוא',
        all:'הכול',
      },
      ru: {
        _dir:'ltr',
        title:'График смен',
        settings:'Настройки',
        tip:'Обновления делаются на странице настроек и сохраняются в браузере (localStorage).',
        morning:'Утро', evening:'Вечер',
        weekdaysFull:['Воскресенье','Понедельник','Вторник','Среда','Четверг','Пятница','Суббота'],
        langToggle:'Русский',
        showBO:'Показывать Backoffice',
        edit:'Редактировать',
        add:'Добавить', remove:'Удалить',
        timePH:'Время',
        fmt:(iso)=> new Date(iso).toLocaleDateString('ru-RU'),
        btnTxt:'TXT', btnDocx:'DOCX', btnPdf:'PDF',
        labelMorning:(i)=>`Утро`,
        labelEvening:(i)=>`Вечер`,
        chooseDays:'Выберите дни для экспорта',
        all:'Все',
      }
    };
    function getLang(){ return localStorage.getItem('lang')||'he'; }
    function setLang(l){ localStorage.setItem('lang',l); applyLang(); render(); renderDayPicker(); }

    function applyLang(){
      const L = I18N[getLang()];
      document.documentElement.dir = L._dir;
      document.documentElement.lang = getLang();
      t_title.textContent = L.title;
      t_settings.textContent = L.settings;
      t_tip.textContent = L.tip;
      t_showBO.textContent = L.showBO;
      t_edit.textContent = L.edit;
      langToggle.textContent = (getLang()==='he'?'Русский':'עברית');
      btnTxt.textContent = L.btnTxt;
      btnDocx.textContent = L.btnDocx;
      btnPdf.textContent = L.btnPdf;
    }

    // ===== data helpers =====
    function loadDates(){
      try{ const a=JSON.parse(localStorage.getItem('weekDates')||'[]'); if(Array.isArray(a)&&a.length===7) return a; }catch(e){}
      const now=new Date(); const delta=(now.getDay()+7-0)%7; const sun=new Date(now); sun.setDate(now.getDate()-delta);
      return Array.from({length:7},(_,i)=>{ const d=new Date(sun); d.setDate(sun.getDate()+i); return d.toISOString().slice(0,10); });
    }
    function loadEmployees(){ try{ const a=JSON.parse(localStorage.getItem('employees')||'[]'); return Array.isArray(a)?a:[]; }catch(e){ return []; } }
    function saveEmployees(list){ localStorage.setItem('employees', JSON.stringify(list)); }

    // ===== выбор дней для экспорта =====
    function loadExportDays(){
      try{ const a=JSON.parse(localStorage.getItem('exportDays')||'[]'); if(Array.isArray(a)&&a.length===7) return a.map(Boolean); }catch(e){}
      return [true,true,true,true,true,true,true];
    }
    function saveExportDays(arr){ localStorage.setItem('exportDays', JSON.stringify(arr)); }
    function selectedDayIndices(){
      const arr = loadExportDays();
      const idx = [];
      for(let i=0;i<7;i++) if(arr[i]) idx.push(i);
      return idx;
    }

    function renderDayPicker(){
      const L = I18N[getLang()];
      const wrap = document.getElementById('dayPicker');
      wrap.innerHTML = '';

      const label = document.createElement('span');
      label.className = 'label';
      label.textContent = L.chooseDays + ':';
      wrap.appendChild(label);

      const arr = loadExportDays();
      // чекбоксы дней
      for(let i=0;i<7;i++){
        const badge = document.createElement('label');
        badge.className = 'badge';
        const cb = document.createElement('input');
        cb.type = 'checkbox'; cb.checked = arr[i];
        cb.addEventListener('change', ()=>{ arr[i] = cb.checked; saveExportDays(arr); });
        const txt = document.createElement('span');
        txt.textContent = I18N[getLang()].weekdaysFull[i];
        badge.appendChild(cb); badge.appendChild(txt);
        wrap.appendChild(badge);
      }

      // «все»
      const allB = document.createElement('button');
      allB.className = 'btn ghost';
      allB.textContent = L.all;
      allB.onclick = ()=>{ saveExportDays([true,true,true,true,true,true,true]); renderDayPicker(); };
      wrap.appendChild(allB);
    }

    // ===== core builders =====
    function buildSchedule(employees){
      const showBO = localStorage.getItem('showBackend')==='1';
      const sched = Array.from({length:7},()=>({morning:[], evening:[]}));
      for(let empIndex=0; empIndex<employees.length; empIndex++){
        const emp = employees[empIndex];
        if(!showBO && emp.backend) continue;
        const name=(emp.name||'').trim(), shifts=emp.shifts||{};
        for(let i=0;i<7;i++){
          const d=shifts['d'+i]||{};
          if(d.m) sched[i].morning.push({name, time: d.timeM||'', empIndex});
          if(d.e) sched[i].evening.push({name, time: d.timeE||'', empIndex});
        }
      }
      const locale = getLang()==='he' ? 'he' : 'ru';
      for(const day of sched){
        day.morning.sort((a,b)=>a.name.localeCompare(b.name,locale));
        day.evening.sort((a,b)=>a.name.localeCompare(b.name,locale));
      }
      return sched;
    }

    // mutate helpers (edit mode)
    function removeEntry(employees, empIndex, dayIndex, part){
      const emp = employees[empIndex]; if(!emp || !emp.shifts) return;
      const key = 'd'+dayIndex;
      emp.shifts[key] = emp.shifts[key] || {m:false,e:false,timeM:'',timeE:''};
      emp.shifts[key][part] = false;
      if(part==='m') emp.shifts[key].timeM = '';
      if(part==='e') emp.shifts[key].timeE = '';
      saveEmployees(employees);
    }
    function addEntry(employees, empIndex, dayIndex, part, timeText){
      const emp = employees[empIndex]; if(!emp) return;
      const key = 'd'+dayIndex;
      emp.shifts = emp.shifts || {};
      emp.shifts[key] = emp.shifts[key] || {m:false,e:false,timeM:'',timeE:''};
      emp.shifts[key][part] = true;
      if(part==='m') emp.shifts[key].timeM = timeText||'';
      if(part==='e') emp.shifts[key].timeE = timeText||'';
      saveEmployees(employees);
    }

    // UI: add row builder
    function renderAddRow(container, employees, dayIndex, part){
      const L = I18N[getLang()];
      const row = document.createElement('div');
      row.className = 'addRow';

      const sel = document.createElement('select');
      const showBO = localStorage.getItem('showBackend')==='1';
      employees.forEach((e, idx)=>{
        if(!showBO && e.backend) return;
        const opt = document.createElement('option');
        opt.value = String(idx);
        opt.textContent = e.name || ('#'+(idx+1));
        sel.appendChild(opt);
      });

      const time = document.createElement('input');
      time.type='text';
      time.placeholder = L.timePH;

      const btn = document.createElement('button');
      btn.className='btn'; btn.textContent=L.add;
      btn.onclick = ()=>{
        const empIndex = parseInt(sel.value,10);
        addEntry(employees, empIndex, dayIndex, part, time.value.trim());
        render();
      };

      row.appendChild(sel);
      row.appendChild(time);
      row.appendChild(btn);
      container.appendChild(row);
    }

    function render(){
      const L = I18N[getLang()];
      const grid = document.getElementById('daysGrid'); grid.innerHTML='';
      const dates = loadDates();
      const employees = loadEmployees();
      const schedule = buildSchedule(employees);
      const edit = document.getElementById('editMode').checked;

      const exportIdx = selectedDayIndices(); // показать все, но отметим для PDF позже

      for(let i=0;i<7;i++){
        const card=document.createElement('section'); card.className='day-card'; card.dataset.dayindex = i;
        const head=document.createElement('div'); head.className='day-head';
        const dow=document.createElement('div'); dow.className='dow'; dow.textContent=L.weekdaysFull[i];
        const date=document.createElement('div'); date.className='date'; date.textContent=L.fmt(dates[i]);
        head.appendChild(dow); head.appendChild(date);

        // MORNING
        const secM=document.createElement('div'); secM.className='section';
        const titleM=document.createElement('h3'); titleM.textContent=L.morning; secM.appendChild(titleM);
        const mList=schedule[i].morning;
        if(mList.length){
          const ol=document.createElement('ol');
          mList.forEach((p, idx)=>{
            const li=document.createElement('li');
            const left=document.createElement('span'); left.className='li-text';
            left.innerHTML = `<span class="li-num">${idx+1}.</span> ${p.name}${p.time?` — ${p.time}`:''}`;
            li.appendChild(left);
            if(edit){
              const btn=document.createElement('button'); btn.className='btn icon'; btn.title=L.remove; btn.textContent='×';
              btn.onclick=()=>{ removeEntry(employees, p.empIndex, i, 'm'); render(); };
              li.appendChild(btn);
            }
            ol.appendChild(li);
          });
          secM.appendChild(ol);
        } else {
          const em=document.createElement('div'); em.className='empty'; em.textContent='—'; secM.appendChild(em);
        }
        if(edit){
          const addBtn=document.createElement('button'); addBtn.className='btn ghost'; addBtn.textContent=L.add;
          const addWrap=document.createElement('div');
          addBtn.onclick=()=>{ addBtn.disabled=true; renderAddRow(addWrap, employees, i, 'm'); };
          titleM.appendChild(addBtn);
          secM.appendChild(addWrap);
        }

        // EVENING
        const secE=document.createElement('div'); secE.className='section';
        const titleE=document.createElement('h3'); titleE.textContent=L.evening; secE.appendChild(titleE);
        const eList=schedule[i].evening;
        if(eList.length){
          const ol=document.createElement('ol');
          eList.forEach((p, idx)=>{
            const li=document.createElement('li');
            const left=document.createElement('span'); left.className='li-text';
            left.innerHTML = `<span class="li-num">${idx+1}.</span> ${p.name}${p.time?` — ${p.time}`:''}`;
            li.appendChild(left);
            if(edit){
              const btn=document.createElement('button'); btn.className='btn icon'; btn.title=L.remove; btn.textContent='×';
              btn.onclick=()=>{ removeEntry(employees, p.empIndex, i, 'e'); render(); };
              li.appendChild(btn);
            }
            ol.appendChild(li);
          });
          secE.appendChild(ol);
        } else {
          const em=document.createElement('div'); em.className='empty'; em.textContent='—'; secE.appendChild(em);
        }
        if(edit){
          const addBtn=document.createElement('button'); addBtn.className='btn ghost'; addBtn.textContent=L.add;
          const addWrap=document.createElement('div');
          addBtn.onclick=()=>{ addBtn.disabled=true; renderAddRow(addWrap, employees, i, 'e'); };
          titleE.appendChild(addBtn);
          secE.appendChild(addWrap);
        }

        grid.appendChild(card);
      }
    }

    // ===== экспорт TXT (с учётом выбранных дней) =====
    function buildExportLines(selectedIdx){
      const L = I18N[getLang()];
      const dates = loadDates();
      const employees = loadEmployees();
      const schedule = buildSchedule(employees);

      const lines = [];
      for(const i of selectedIdx){
        lines.push(`${L.weekdaysFull[i]} — ${L.fmt(dates[i])}`);
        // Утро
        lines.push(`${L.labelMorning(i)}:`);
        if(schedule[i].morning.length){
          schedule[i].morning.forEach((p, idx)=>{
            lines.push(`${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);
          });
        } else { lines.push('—'); }
        // Вечер
        lines.push(`${L.labelEvening(i)}:`);
        if(schedule[i].evening.length){
          schedule[i].evening.forEach((p, idx)=>{
            lines.push(`${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);
          });
        } else { lines.push('—'); }
        lines.push('');
      }
      return lines;
    }

    function downloadBlob(str, mime, filename){
      const blob = new Blob([str], {type: mime});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);
    }

    document.getElementById('btnTxt').addEventListener('click', ()=>{
      const lines = buildExportLines(selectedDayIndices());
      downloadBlob(lines.join('\n'), 'text/plain;charset=utf-8', 'schedule.txt');
    });

    // ===== DOCX (двухколоночные таблицы) с учётом выбранных дней =====
    function makeDayTable(docxNS, L, dayData, isRTL){
      const { Table, TableRow, TableCell, Paragraph, TextRun, WidthType, AlignmentType, ShadingType, BorderStyle } = docxNS;

      const cellHdr = (text)=> new TableCell({
        children: [ new Paragraph({ children:[ new TextRun({ text, bold:true }) ], alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT, bidirectional:isRTL }) ],
        shading: { type: ShadingType.CLEAR, color: "FFFFFF", fill: "EEF4FF" },
        margins: { top:120, bottom:120, left:180, right:180 }
      });

      const cellList = (items)=> new TableCell({
        children: items.length ? items.map((line)=> new Paragraph({ children:[ new TextRun(line) ], alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT, bidirectional:isRTL }))
                               : [ new Paragraph({ children:[ new TextRun("—") ], alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT, bidirectional:isRTL }) ],
        margins: { top:120, bottom:120, left:180, right:180 }
      });

      const headerRow = new TableRow({ children: [ cellHdr(L.morning), cellHdr(L.evening) ] });
      const mLines = dayData.morning.map((p,idx)=> `${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);
      const eLines = dayData.evening.map((p,idx)=> `${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);
      const listRow = new TableRow({ children: [ cellList(mLines), cellList(eLines) ] });

      return new Table({
        rows: [headerRow, listRow],
        width: { size: 100, type: WidthType.PERCENTAGE },
        borders: {
          top:   { style: BorderStyle.SINGLE, size: 4, color: "DDE3EA" },
          bottom:{ style: BorderStyle.SINGLE, size: 4, color: "DDE3EA" },
          left:  { style: BorderStyle.SINGLE, size: 4, color: "DDE3EA" },
          right: { style: BorderStyle.SINGLE, size: 4, color: "DDE3EA" },
          insideH: { style: BorderStyle.SINGLE, size: 4, color: "E8EDF3" },
          insideV: { style: BorderStyle.SINGLE, size: 4, color: "E8EDF3" },
        }
      });
    }

    document.getElementById('btnDocx').addEventListener('click', async ()=>{
      const L = I18N[getLang()];
      const isRTL = (getLang()==='he');
      const selIdx = selectedDayIndices();

      const dates = loadDates();
      const employees = loadEmployees();
      const schedule = buildSchedule(employees);

      const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType, PageOrientation } = window.docx;
      const children = [];

      children.push(new Paragraph({
        children: [ new TextRun(L.title) ],
        heading: HeadingLevel.HEADING_1,
        alignment: AlignmentType.CENTER
      }));

      for (const i of selIdx) {
        children.push(new Paragraph({
          children: [ new TextRun(`${L.weekdaysFull[i]} — ${L.fmt(dates[i])}`) ],
          heading: HeadingLevel.HEADING_2,
          alignment: isRTL ? AlignmentType.RIGHT : AlignmentType.LEFT,
        }));
        children.push( makeDayTable(window.docx, L, schedule[i], isRTL) );
        children.push(new Paragraph({ children:[ new TextRun('') ] }));
      }

      const doc = new Document({
        sections: [{
          properties: {
            page: {
              size: { width: 11906, height: 16838, orientation: PageOrientation.PORTRAIT },
              margin: { top: 720, right: 720, bottom: 720, left: 720 }
            }
          },
          children
        }]
      });

      const blob = await Packer.toBlob(doc);
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'schedule.docx';
      document.body.appendChild(a); a.click();
      a.remove(); URL.revokeObjectURL(url);
    });

    // ===== PDF (html2pdf) — экспортируются только выбранные дни =====
    document.getElementById('btnPdf').addEventListener('click', ()=>{
      // соберём временную «печатаемую» область с выбранными днями
      const selIdx = selectedDayIndices();
      const L = I18N[getLang()];
      const dates = loadDates();

      const employees = loadEmployees();
      const schedule = buildSchedule(employees);

      const container = document.createElement('div');
      container.style.padding = '16px';
      container.style.fontFamily = 'Arial, Helvetica, sans-serif';
      container.dir = (getLang()==='he') ? 'rtl' : 'ltr';

      const title = document.createElement('h1');
      title.textContent = L.title;
      title.style.textAlign = 'center';
      title.style.margin = '0 0 16px 0';
      container.appendChild(title);

      selIdx.forEach(i=>{
        const block = document.createElement('div');
        block.style.border = '1px solid #e6e6e6';
        block.style.borderRadius = '10px';
        block.style.padding = '12px';
        block.style.marginBottom = '12px';
        block.style.background = '#fff';

        const h2 = document.createElement('h2');
        h2.textContent = `${L.weekdaysFull[i]} — ${L.fmt(dates[i])}`;
        h2.style.margin = '0 0 8px 0';
        block.appendChild(h2);

        const table = document.createElement('table');
        table.style.width = '100%';
        table.style.borderCollapse = 'collapse';
        table.innerHTML = `
          <thead>
            <tr>
              <th style="text-align:${getLang()==='he'?'right':'left'};background:#eef4ff;border:1px solid #dde3ea;padding:6px 8px;">${L.morning}</th>
              <th style="text-align:${getLang()==='he'?'right':'left'};background:#eef4ff;border:1px solid #dde3ea;padding:6px 8px;">${L.evening}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="vertical-align:top;border:1px solid #e8edf3;padding:6px 8px;"></td>
              <td style="vertical-align:top;border:1px solid #e8edf3;padding:6px 8px;"></td>
            </tr>
          </tbody>
        `;
        const tds = table.querySelectorAll('td');

        const mLines = schedule[i].morning.map((p,idx)=> `${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);
        const eLines = schedule[i].evening.map((p,idx)=> `${idx+1}. ${p.name}${p.time?` — ${p.time}`:''}`);

        tds[0].innerHTML = mLines.length ? mLines.map(l=>`<div>${l}</div>`).join('') : `<div style="color:#999">—</div>`;
        tds[1].innerHTML = eLines.length ? eLines.map(l=>`<div>${l}</div>`).join('') : `<div style="color:#999">—</div>`;

        block.appendChild(table);
        container.appendChild(block);
      });

      const opt = {
        margin:       10,               // мм
        filename:     'schedule.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2, useCORS: true },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak:    { mode: ['css', 'legacy'] }
      };

      html2pdf().set(opt).from(container).save();
    });

    // init
    document.getElementById('showBO').checked = localStorage.getItem('showBackend')==='1';
    document.getElementById('showBO').addEventListener('change',(e)=>{
      localStorage.setItem('showBackend', e.target.checked ? '1' : '0');
      render();
    });
    document.getElementById('editMode').addEventListener('change', render);
    document.getElementById('langToggle').addEventListener('click',(e)=>{e.preventDefault(); setLang(getLang()==='he'?'ru':'he');});
    applyLang(); render(); renderDayPicker();
  </script>
</body>
</html>
