<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Расписание смен</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f7f7f7;
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .days-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        .day-block {
            background: #ffffff;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: calc(100% / 7 - 10px);
            margin: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 10px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }
        .day-header {
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
        }
        .shift-list {
            flex: 1;
            margin-bottom: 8px;
        }
        .shift-title {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 3px;
        }
        .shift-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .shift-list li {
            font-size: 0.85em;
            margin-bottom: 2px;
        }
        .footer-link {
            text-align: center;
            margin-top: 20px;
        }
        @media (max-width: 800px) {
            .day-block {
                width: calc(50% - 10px);
            }
        }
        @media (max-width: 500px) {
            .day-block {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <h1>Расписание смен</h1>
    <div class="days-container" id="daysContainer">
        <!-- day blocks will be generated by JavaScript -->
    </div>
    <div class="footer-link">
        <a href="settings.html">Настройки</a>
    </div>

    <script>
    // Utility to format date as DD-MM and get day of week in Russian
    function formatDate(dateStr) {
        if (!dateStr) return {date:'', dow:''};
        const date = new Date(dateStr);
        if (isNaN(date)) return {date: dateStr, dow:''};
        const options = { weekday: 'short'};
        const dow = date.toLocaleDateString('ru-RU', options);
        const d = ('0' + date.getDate()).slice(-2);
        const m = ('0' + (date.getMonth()+1)).slice(-2);
        return {date: `${d}-${m}`, dow: dow.charAt(0).toUpperCase() + dow.slice(1)};
    }
    // Load schedule from localStorage
    function loadSchedule() {
        const data = JSON.parse(localStorage.getItem('scheduleData') || '{}');
        // default dates: 7 days from today
        const today = new Date();
        let dates = data.dates || [];
        if (dates.length !== 7) {
            dates = [];
            for (let i = 0; i < 7; i++) {
                const d = new Date();
                d.setDate(today.getDate() + i);
                dates.push(d.toISOString().substring(0,10));
            }
        }
        const employees = data.employees || [];
        return {dates, employees};
    }
    function buildView() {
        const container = document.getElementById('daysContainer');
        container.innerHTML = '';
        const {dates, employees} = loadSchedule();
        dates.forEach((dateStr, idx) => {
            const {date, dow} = formatDate(dateStr);
            const block = document.createElement('div');
            block.className = 'day-block';
            // header
            const header = document.createElement('div');
            header.className = 'day-header';
            header.textContent = dow + ' ' + date;
            block.appendChild(header);
            // morning list
            const morningDiv = document.createElement('div');
            morningDiv.className = 'shift-list';
            const mTitle = document.createElement('div');
            mTitle.className = 'shift-title';
            mTitle.textContent = 'Утро';
            morningDiv.appendChild(mTitle);
            const mList = document.createElement('ul');
            // collect morning names
            let mCounter = 1;
            employees.forEach(emp => {
                if (emp.shifts && emp.shifts[idx + '-morning']) {
                    const li = document.createElement('li');
                    li.textContent = mCounter + '. ' + emp.name;
                    mList.appendChild(li);
                    mCounter++;
                }
            });
            if (mCounter === 1) {
                const li = document.createElement('li');
                li.textContent = '—';
                mList.appendChild(li);
            }
            morningDiv.appendChild(mList);
            block.appendChild(morningDiv);
            // evening list
            const eveningDiv = document.createElement('div');
            eveningDiv.className = 'shift-list';
            const eTitle = document.createElement('div');
            eTitle.className = 'shift-title';
            eTitle.textContent = 'Вечер';
            eveningDiv.appendChild(eTitle);
            const eList = document.createElement('ul');
            let eCounter = 1;
            employees.forEach(emp => {
                if (emp.shifts && emp.shifts[idx + '-evening']) {
                    const li = document.createElement('li');
                    li.textContent = eCounter + '. ' + emp.name;
                    eList.appendChild(li);
                    eCounter++;
                }
            });
            if (eCounter === 1) {
                const li = document.createElement('li');
                li.textContent = '—';
                eList.appendChild(li);
            }
            eveningDiv.appendChild(eList);
            block.appendChild(eveningDiv);
            container.appendChild(block);
        });
    }
    document.addEventListener('DOMContentLoaded', buildView);
    </script>
</body>
</html>